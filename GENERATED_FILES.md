# Generated Files Documentation

This document explains which files are automatically generated from the OpenAPI specifications and how to manage them.

## Overview

The Terraform Provider Umbrella uses a sophisticated code generation system that automatically creates Terraform resources, data sources, client methods, tests, and documentation from OpenAPI specifications located in the `api-specs/` directory.

## Generated File Categories

### 1. Generated Go Files (`internal/provider/`)

These files are automatically generated from the API specifications:

#### **Core Generated Files**
- `generated_client_methods.go` - Enhanced API client with caching and error handling

#### **Resource-Specific Generated Files**
Pattern: `generated_resource_*.go` and `generated_data_source_*.go`

All generated files are prefixed with `generated_` and contain a generation marker comment at the top:
```go
// Code generated by terraform-provider-umbrella generator. DO NOT EDIT.
```

**Currently Generated Files (Tier 1 + Tier 2 APIs)**:

**Resources**:
- `generated_resource_destinationlists.go` - Destination lists management
- `generated_resource_destinations.go` - Individual destinations management
- `generated_resource_networks.go` - Network infrastructure management
- `generated_resource_sites.go` - Site configuration management
- `generated_resource_users.go` - User management
- `generated_resource_passwordresets.go` - Password reset operations
- `generated_resource_internalnetworks.go` - Internal networks management (Tier 2)
- `generated_resource_networkdevices.go` - Network devices management (Tier 2)
- `generated_resource_roamingcomputers.go` - Roaming computers management (Tier 2)
- `generated_resource_identities.go` - Identity and deployment management (Tier 2)

**Data Sources**:
- `generated_data_source_destinationlists.go` - Destination lists data source
- `generated_data_source_destinations.go` - Destinations data source
- `generated_data_source_networks.go` - Networks data source
- `generated_data_source_policies.go` - Policies data source
- `generated_data_source_sites.go` - Sites data source
- `generated_data_source_users.go` - Users data source
- `generated_data_source_roles.go` - Roles data source
- `generated_data_source_organizations.go` - Organizations data source
- `generated_data_source_internalnetworks.go` - Internal networks data source (Tier 2)
- `generated_data_source_networkdevices.go` - Network devices data source (Tier 2)
- `generated_data_source_roamingcomputers.go` - Roaming computers data source (Tier 2)
- `generated_data_source_orginfo.go` - Organization info data source (Tier 2)

### 2. Generated Test Files (`internal/provider/tests/`)

Pattern: `*_test.go` (except `provider_test.go` which is manually maintained)

Currently generated:
- `destination_list_test.go` - Destination list resource tests
- `internal_networks_test.go` - Internal networks resource tests
- `networks_test.go` - Networks resource tests
- `sites_test.go` - Sites resource tests
- `users_test.go` - Users resource tests

**Note**: `provider_test.go` is manually maintained and should NOT be deleted.

### 3. Generated Documentation (`docs/resources/`)

Pattern: `*.md` files in `docs/resources/`

Currently generated:
- `destination_list.md` - Destination list resource documentation
- `internalnetworks.md` - Internal networks resource documentation
- `networks.md` - Networks resource documentation
- `sites.md` - Sites resource documentation
- `users.md` - Users resource documentation

**Note**: `docs/index.md` is manually maintained and should NOT be deleted.

## Manual vs Generated Files

### ✅ **Safe to Delete (Generated)**
These files are automatically regenerated when you run `make generate-full`:

```
internal/provider/generated_*.go
internal/provider/tests/*_test.go (except provider_test.go)
docs/resources/*.md
```

**Note**: Files with the generation marker comment are also safe to delete:
```go
// Code generated by terraform-provider-umbrella generator. DO NOT EDIT.
```

### ⚠️ **DO NOT DELETE (Manual)**
These files are manually created and maintained:

```
internal/provider/provider.go
internal/provider/client.go
internal/provider/utils.go
internal/provider/resource_*.go (non-generated resources)
internal/provider/data_source_*.go
internal/provider/tests/provider_test.go
docs/index.md
```

## Makefile Targets for Generated Files

### Clean Generated Files
```bash
# Clean only generated files from API specs
make clean-generated
```

This target removes:
- All `internal/provider/generated_*.go` files
- All test files except `provider_test.go`
- All documentation files except `docs/index.md`

### Clean Everything
```bash
# Clean build artifacts + generated files
make clean-all
```

### Regenerate After Cleaning
```bash
# Clean and regenerate everything
make clean-generated
make generate-full
```

## Generation Process

### Input Sources
The generator processes these OpenAPI specification files from `api-specs/`:

**Tier 1 APIs (Processed)**:
- `cisco_umbrella_destination_lists_api_2_0_0.yaml` - Destination lists and destinations management
- `cisco_umbrella_networks_api_2_0_0.yaml` - Network infrastructure and policies
- `cisco_umbrella_sites_api_2_0_0.yaml` - Site configuration management
- `cisco_umbrella_users_and_roles_api_2_0_0.yaml` - User, role, and organization management

**Tier 2 APIs (Processed)**:
- `cisco_umbrella_internal_networks_api_2_0_0.yaml` - Internal networks management
- `cisco_umbrella_network_devices_api_2_0_0.yaml` - Network devices management
- `cisco_umbrella_roaming_computers_api_2_0_0.yaml` - Roaming computers management
- `cisco_umbrella_deployments_policies_api_2_0_0.yaml` - Deployment and policy management

**Tier 3 APIs (Available for Processing)**:
- `cisco_umbrella_internal_domains_api_2_0_0.yaml` - Internal domains management
- `cisco_umbrella_virtual_appliances_api_2_0_0.yaml` - Virtual appliances management
- `cisco_umbrella_network_tunnels_api_2_0_0.yaml` - Network tunnels management
- `cisco_umbrella_tagging_api_2_0_0.yaml` - Resource tagging management
- And 12 additional Tier 3+ APIs available for future processing

### Generation Configuration
The generation process is controlled by:
- `tools/generator/config/generation.yaml` - Main configuration
- `tools/generator/config/advanced_config.yaml` - Advanced settings

### File Naming Patterns
Based on the configuration in `generation.yaml`:

- **Resources**: `generated_resource_{resource_name}.go`
- **Data Sources**: `generated_data_source_{resource_name}.go`
- **Client Methods**: `generated_client_methods.go`
- **Tests**: `{resource_name}_test.go`
- **Documentation**: `{resource_name}.md`

All generated files include a generation marker comment at the top for easy identification.

## Best Practices

### 1. Always Clean Before Regenerating
```bash
make clean-generated && make generate-full
```

### 2. Don't Edit Generated Files
Generated files contain a header comment indicating they are auto-generated. Never edit these files manually as changes will be lost.

### 3. Use Version Control
Generated files are tracked in Git to ensure consistency across environments. After regeneration, commit the changes:

```bash
make clean-generated
make generate-full
git add .
git commit -m "Regenerate provider code from updated API specs"
```

### 4. Validate After Generation
```bash
make generate-full
make test
make build
```

## Troubleshooting

### Generated Files Not Updating
1. Clean generated files: `make clean-generated`
2. Regenerate: `make generate-full`
3. Check for errors in the generation process

### Build Errors After Generation
1. Ensure all API specs are valid OpenAPI 3.0+ format
2. Check the generation configuration in `tools/generator/config/`
3. Run `go fmt ./internal/provider/generated_*.go`

### Missing Generated Files
1. Verify API spec files exist in `api-specs/`
2. Check that specs contain valid resource definitions
3. Review generation logs for parsing errors

## Development Workflow

### Adding New API Specifications
1. Add new `.yaml` file to `api-specs/`
2. Run `make clean-generated && make generate-full`
3. Test the generated resources
4. Commit the changes

### Modifying Existing API Specifications
1. Update the `.yaml` file in `api-specs/`
2. Run `make clean-generated && make generate-full`
3. Review the generated changes
4. Update any manual code that depends on the changes
5. Test and commit

### Custom Resource Development
For resources that require custom logic beyond what can be generated:
1. Create manual resource files (e.g., `resource_custom.go`)
2. Add them to the provider registration in `provider.go`
3. Do NOT use the `generated_` prefix to avoid conflicts

This documentation ensures clear understanding of the generated file system and proper maintenance procedures.
